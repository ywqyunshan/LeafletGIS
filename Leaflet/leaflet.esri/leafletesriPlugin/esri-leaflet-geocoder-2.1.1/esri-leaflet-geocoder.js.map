{"version":3,"file":"esri-leaflet-geocoder.js","sources":["../package.json","../src/Tasks/Geocode.js","../src/Tasks/ReverseGeocode.js","../src/Tasks/Suggest.js","../src/Services/Geocode.js","../src/Classes/GeosearchCore.js","../src/Controls/Geosearch.js","../src/Providers/ArcgisOnlineGeocoder.js","../src/Providers/FeatureLayer.js","../src/Providers/MapService.js","../src/Providers/GeocodeService.js","../src/EsriLeafletGeocoding.js"],"sourcesContent":["{\n  \"name\": \"esri-leaflet-geocoder\",\n  \"description\": \"Esri Geocoding utility and search plugin for Leaflet.\",\n  \"version\": \"2.1.1\",\n  \"author\": \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\n  \"contributors\": [\n    \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\n    \"John Gravois <jgravois@esri.com> (http://johngravois.com)\"\n  ],\n  \"dependencies\": {\n    \"esri-leaflet\": \"^2.0.0\",\n    \"leaflet\": \"^1.0.0-rc.1\"\n  },\n  \"devDependencies\": {\n    \"chai\": \"2.3.0\",\n    \"gh-release\": \"^2.0.0\",\n    \"http-server\": \"^0.8.5\",\n    \"imagemin\": \"^3.2.0\",\n    \"isparta\": \"^3.0.3\",\n    \"istanbul\": \"^0.4.2\",\n    \"karma\": \"^0.12.24\",\n    \"karma-chai-sinon\": \"^0.1.3\",\n    \"karma-coverage\": \"^0.5.3\",\n    \"karma-mocha\": \"^0.1.0\",\n    \"karma-mocha-reporter\": \"^0.2.5\",\n    \"karma-phantomjs-launcher\": \"^0.2.0\",\n    \"karma-sourcemap-loader\": \"^0.3.5\",\n    \"mkdirp\": \"^0.5.1\",\n    \"mocha\": \"^2.3.4\",\n    \"node-sass\": \"^3.2.0\",\n    \"phantomjs\": \"^1.9.17\",\n    \"rollup\": \"^0.25.4\",\n    \"rollup-plugin-json\": \"^2.0.0\",\n    \"rollup-plugin-node-resolve\": \"^1.4.0\",\n    \"rollup-plugin-uglify\": \"^0.3.1\",\n    \"semistandard\": \"^7.0.5\",\n    \"sinon\": \"^1.11.1\",\n    \"sinon-chai\": \"2.7.0\",\n    \"uglify-js\": \"^2.6.1\",\n    \"watch\": \"^0.17.1\"\n  },\n  \"homepage\": \"https://github.com/Esri/esri-leaflet-geocoder\",\n  \"jsnext:main\": \"src/EsriLeafletGeocoding.js\",\n  \"jspm\": {\n    \"registry\": \"npm\",\n    \"format\": \"es6\",\n    \"main\": \"src/EsriLeafletGeocoding.js\"\n  },\n  \"license\": \"Apache-2.0\",\n  \"main\": \"dist/esri-leaflet-geocoder-debug.js\",\n  \"browser\": \"dist/esri-leaflet-geocoder-debug.js\",\n  \"readmeFilename\": \"README.md\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git@github.com:Esri/esri-leaflet-geocoder.git\"\n  },\n  \"scripts\": {\n    \"prebuild\": \"mkdirp dist\",\n    \"build\": \"rollup -c profiles/debug.js & rollup -c profiles/production.js & npm run css & npm run img\",\n    \"css\": \"node-sass ./src/esri-leaflet-geocoder.css ./dist/esri-leaflet-geocoder.css --output-style compressed\",\n    \"img\": \"imagemin ./src/img ./dist/img\",\n    \"lint\": \"semistandard src/**/*.js\",\n    \"prepublish\": \"npm run build\",\n    \"pretest\": \"npm run build\",\n    \"release\": \"./scripts/release.sh\",\n    \"start\": \"watch 'npm run build' src & http-server -p 5678 -c-1 -o\",\n    \"test\": \"npm run lint && karma start\"\n  },\n  \"style\": \"./dist/esri-leaflet-geocoder.css\"\n}\n","import L from 'leaflet';\nimport { Task, Util } from 'esri-leaflet';\nimport { WorldGeocodingServiceUrl } from '../EsriLeafletGeocoding';\n\nexport var Geocode = Task.extend({\n  path: 'find',\n\n  params: {\n    outSr: 4326,\n    forStorage: false,\n    outFields: '*',\n    maxLocations: 20\n  },\n\n  setters: {\n    'address': 'address',\n    'neighborhood': 'neighborhood',\n    'city': 'city',\n    'subregion': 'subregion',\n    'region': 'region',\n    'postal': 'postal',\n    'country': 'country',\n    'text': 'text',\n    'category': 'category',\n    'token': 'token',\n    'key': 'magicKey',\n    'fields': 'outFields',\n    'forStorage': 'forStorage',\n    'maxLocations': 'maxLocations'\n  },\n\n  initialize: function (options) {\n    options = options || {};\n    options.url = options.url || WorldGeocodingServiceUrl;\n    Task.prototype.initialize.call(this, options);\n  },\n\n  within: function (bounds) {\n    bounds = L.latLngBounds(bounds);\n    this.params.bbox = Util.boundsToExtent(bounds);\n    return this;\n  },\n\n  nearby: function (latlng, radius) {\n    latlng = L.latLng(latlng);\n    this.params.location = latlng.lng + ',' + latlng.lat;\n    this.params.distance = Math.min(Math.max(radius, 2000), 50000);\n    return this;\n  },\n\n  run: function (callback, context) {\n    if (this.options.customParam) {\n      this.path = 'findAddressCandidates';\n      this.params[this.options.customParam] = this.params.text;\n      delete this.params.text;\n    } else {\n      this.path = (this.params.text) ? 'find' : 'findAddressCandidates';\n    }\n\n    if (this.path === 'findAddressCandidates' && this.params.bbox) {\n      this.params.searchExtent = this.params.bbox;\n      delete this.params.bbox;\n    }\n\n    return this.request(function (error, response) {\n      var processor = (this.path === 'find') ? this._processFindResponse : this._processFindAddressCandidatesResponse;\n      var results = (!error) ? processor(response) : undefined;\n      callback.call(context, error, { results: results }, response);\n    }, this);\n  },\n\n  _processFindResponse: function (response) {\n    var results = [];\n\n    for (var i = 0; i < response.locations.length; i++) {\n      var location = response.locations[i];\n      var bounds;\n\n      if (location.extent) {\n        bounds = Util.extentToBounds(location.extent);\n      }\n\n      results.push({\n        text: location.name,\n        bounds: bounds,\n        score: location.feature.attributes.Score,\n        latlng: L.latLng(location.feature.geometry.y, location.feature.geometry.x),\n        properties: location.feature.attributes\n      });\n    }\n\n    return results;\n  },\n\n  _processFindAddressCandidatesResponse: function (response) {\n    var results = [];\n\n    for (var i = 0; i < response.candidates.length; i++) {\n      var candidate = response.candidates[i];\n      if (candidate.extent) {\n        var bounds = Util.extentToBounds(candidate.extent);\n      }\n\n      results.push({\n        text: candidate.address,\n        bounds: bounds,\n        score: candidate.score,\n        latlng: L.latLng(candidate.location.y, candidate.location.x),\n        properties: candidate.attributes\n      });\n    }\n\n    return results;\n  }\n\n});\n\nexport function geocode (options) {\n  return new Geocode(options);\n}\n\nexport default geocode;\n","import L from 'leaflet';\nimport { Task } from 'esri-leaflet';\nimport { WorldGeocodingServiceUrl } from '../EsriLeafletGeocoding';\n\nexport var ReverseGeocode = Task.extend({\n  path: 'reverseGeocode',\n\n  params: {\n    outSR: 4326,\n    returnIntersection: false\n  },\n\n  setters: {\n    'distance': 'distance',\n    'language': 'langCode',\n    'intersection': 'returnIntersection'\n  },\n\n  initialize: function (options) {\n    options = options || {};\n    options.url = options.url || WorldGeocodingServiceUrl;\n    Task.prototype.initialize.call(this, options);\n  },\n\n  latlng: function (latlng) {\n    latlng = L.latLng(latlng);\n    this.params.location = latlng.lng + ',' + latlng.lat;\n    return this;\n  },\n\n  run: function (callback, context) {\n    return this.request(function (error, response) {\n      var result;\n\n      if (!error) {\n        result = {\n          latlng: L.latLng(response.location.y, response.location.x),\n          address: response.address\n        };\n      } else {\n        result = undefined;\n      }\n\n      callback.call(context, error, result, response);\n    }, this);\n  }\n});\n\nexport function reverseGeocode (options) {\n  return new ReverseGeocode(options);\n}\n\nexport default reverseGeocode;\n","import L from 'leaflet';\nimport { Task, Util } from 'esri-leaflet';\nimport { WorldGeocodingServiceUrl } from '../EsriLeafletGeocoding';\n\nexport var Suggest = Task.extend({\n  path: 'suggest',\n\n  params: {},\n\n  setters: {\n    text: 'text',\n    category: 'category',\n    countries: 'countryCode',\n    maxSuggestions: 'maxSuggestions'\n  },\n\n  initialize: function (options) {\n    options = options || {};\n    if (!options.url) {\n      options.url = WorldGeocodingServiceUrl;\n      options.supportsSuggest = true;\n    }\n    Task.prototype.initialize.call(this, options);\n  },\n\n  within: function (bounds) {\n    bounds = L.latLngBounds(bounds);\n    bounds = bounds.pad(0.5);\n    var center = bounds.getCenter();\n    var ne = bounds.getNorthWest();\n    this.params.location = center.lng + ',' + center.lat;\n    this.params.distance = Math.min(Math.max(center.distanceTo(ne), 2000), 50000);\n    this.params.searchExtent = Util.boundsToExtent(bounds);\n    return this;\n  },\n\n  nearby: function (latlng, radius) {\n    latlng = L.latLng(latlng);\n    this.params.location = latlng.lng + ',' + latlng.lat;\n    this.params.distance = Math.min(Math.max(radius, 2000), 50000);\n    return this;\n  },\n\n  run: function (callback, context) {\n    if (this.options.supportsSuggest) {\n      return this.request(function (error, response) {\n        callback.call(context, error, response, response);\n      }, this);\n    } else {\n      console.warn('this geocoding service does not support asking for suggestions');\n    }\n  }\n\n});\n\nexport function suggest (options) {\n  return new Suggest(options);\n}\n\nexport default suggest;\n","import { Service } from 'esri-leaflet';\nimport { WorldGeocodingServiceUrl } from '../EsriLeafletGeocoding';\nimport geocode from '../Tasks/Geocode';\nimport reverseGeocode from '../Tasks/ReverseGeocode';\nimport suggest from '../Tasks/Suggest';\n\nexport var GeocodeService = Service.extend({\n  initialize: function (options) {\n    options = options || {};\n    if (options.url) {\n      Service.prototype.initialize.call(this, options);\n      this._confirmSuggestSupport();\n    } else {\n      options.url = WorldGeocodingServiceUrl;\n      options.supportsSuggest = true;\n      Service.prototype.initialize.call(this, options);\n    }\n  },\n\n  geocode: function () {\n    return geocode(this);\n  },\n\n  reverse: function () {\n    return reverseGeocode(this);\n  },\n\n  suggest: function () {\n    // requires either the Esri World Geocoding Service or a <10.3 ArcGIS Server Geocoding Service that supports suggest.\n    return suggest(this);\n  },\n\n  _confirmSuggestSupport: function () {\n    this.metadata(function (error, response) {\n      if (error) { return; }\n      // pre 10.3 geocoding services dont list capabilities (and dont support maxLocations)\n      // since, only SOME individual services have been configured to support asking for suggestions\n      if (!response.capabilities) {\n        this.options.supportsSuggest = false;\n        this.options.customParam = response.singleLineAddressField.name;\n      } else if (response.capabilities.indexOf('Suggest') > -1) {\n        this.options.supportsSuggest = true;\n      } else {\n        this.options.supportsSuggest = false;\n      }\n    }, this);\n  }\n});\n\nexport function geocodeService (options) {\n  return new GeocodeService(options);\n}\n\nexport default geocodeService;\n","import L from 'leaflet';\n\nexport var GeosearchCore = L.Evented.extend({\n\n  options: {\n    zoomToResult: true,\n    useMapBounds: 12,\n    searchBounds: null\n  },\n\n  initialize: function (control, options) {\n    L.Util.setOptions(this, options);\n    this._control = control;\n\n    if (!options || !options.providers || !options.providers.length) {\n      throw new Error('You must specify at least one provider');\n    }\n\n    this._providers = options.providers;\n  },\n\n  _geocode: function (text, key, provider) {\n    var activeRequests = 0;\n    var allResults = [];\n    var bounds;\n\n    var callback = L.Util.bind(function (error, results) {\n      activeRequests--;\n      if (error) {\n        return;\n      }\n\n      if (results) {\n        allResults = allResults.concat(results);\n      }\n\n      if (activeRequests <= 0) {\n        bounds = this._boundsFromResults(allResults);\n\n        this.fire('results', {\n          results: allResults,\n          bounds: bounds,\n          latlng: (bounds) ? bounds.getCenter() : undefined,\n          text: text\n        }, true);\n\n        if (this.options.zoomToResult && bounds) {\n          this._control._map.fitBounds(bounds);\n        }\n\n        this.fire('load');\n      }\n    }, this);\n\n    if (key) {\n      activeRequests++;\n      provider.results(text, key, this._searchBounds(), callback);\n    } else {\n      for (var i = 0; i < this._providers.length; i++) {\n        activeRequests++;\n        this._providers[i].results(text, key, this._searchBounds(), callback);\n      }\n    }\n  },\n\n  _suggest: function (text) {\n    var activeRequests = this._providers.length;\n\n    var createCallback = L.Util.bind(function (text, provider) {\n      return L.Util.bind(function (error, suggestions) {\n        if (error) { return; }\n\n        var i;\n\n        activeRequests = activeRequests - 1;\n\n        if (text.length < 2) {\n          this._suggestions.innerHTML = '';\n          this._suggestions.style.display = 'none';\n          return;\n        }\n\n        if (suggestions) {\n          for (i = 0; i < suggestions.length; i++) {\n            suggestions[i].provider = provider;\n          }\n        }\n\n        if (provider._lastRender !== text && provider.nodes) {\n          for (i = 0; i < provider.nodes.length; i++) {\n            if (provider.nodes[i].parentElement) {\n              this._control._suggestions.removeChild(provider.nodes[i]);\n            }\n          }\n\n          provider.nodes = [];\n        }\n\n        if (suggestions.length && this._control._input.value === text) {\n          this._control.clearSuggestions(provider.nodes);\n\n          provider._lastRender = text;\n          provider.nodes = this._control._renderSuggestions(suggestions);\n          this._control._nodes = [];\n        }\n      }, this);\n    }, this);\n\n    this._pendingSuggestions = [];\n\n    for (var i = 0; i < this._providers.length; i++) {\n      var provider = this._providers[i];\n      var request = provider.suggestions(text, this._searchBounds(), createCallback(text, provider));\n      this._pendingSuggestions.push(request);\n    }\n  },\n\n  _searchBounds: function () {\n    if (this.options.searchBounds !== null) {\n      return this.options.searchBounds;\n    }\n\n    if (this.options.useMapBounds === false) {\n      return null;\n    }\n\n    if (this.options.useMapBounds === true) {\n      return this._control._map.getBounds();\n    }\n\n    if (this.options.useMapBounds <= this._control._map.getZoom()) {\n      return this._control._map.getBounds();\n    }\n\n    return null;\n  },\n\n  _boundsFromResults: function (results) {\n    if (!results.length) {\n      return;\n    }\n\n    var nullIsland = L.latLngBounds([0, 0], [0, 0]);\n    var resultBounds = [];\n    var resultLatlngs = [];\n\n    // collect the bounds and center of each result\n    for (var i = results.length - 1; i >= 0; i--) {\n      var result = results[i];\n\n      resultLatlngs.push(result.latlng);\n\n      // make sure bounds are valid and not 0,0. sometimes bounds are incorrect or not present\n      if (result.bounds && result.bounds.isValid() && !result.bounds.equals(nullIsland)) {\n        resultBounds.push(result.bounds);\n      }\n    }\n\n    // form a bounds object containing all center points\n    var bounds = L.latLngBounds(resultLatlngs);\n\n    // and extend it to contain all bounds objects\n    for (var j = 0; j < resultBounds.length; j++) {\n      bounds.extend(resultBounds[j]);\n    }\n\n    return bounds;\n  },\n\n  _getAttribution: function () {\n    var attribs = [];\n    var providers = this._providers;\n\n    for (var i = 0; i < providers.length; i++) {\n      if (providers[i].options.attribution) {\n        attribs.push(providers[i].options.attribution);\n      }\n    }\n\n    return attribs.join(', ');\n  }\n\n});\n\nexport function geosearchCore (control, options) {\n  return new GeosearchCore(control, options);\n}\n\nexport default geosearchCore;\n","import L from 'leaflet';\nimport { geosearchCore } from '../Classes/GeosearchCore';\n\nexport var Geosearch = L.Control.extend({\n  includes: L.Mixin.Events,\n\n  options: {\n    position: 'topleft',\n    collapseAfterResult: true,\n    expanded: false,\n    allowMultipleResults: true,\n    placeholder: 'Search for places or addresses',\n    title: 'Location Search'\n  },\n\n  initialize: function (options) {\n    L.Util.setOptions(this, options);\n\n    if (!options || !options.providers || !options.providers.length) {\n      throw new Error('You must specify at least one provider');\n    }\n\n    // instantiate the underlying class and pass along options\n    this._geosearchCore = geosearchCore(this, options);\n    this._geosearchCore._providers = options.providers;\n\n    // bubble each providers events to the control\n    this._geosearchCore.addEventParent(this);\n    for (var i = 0; i < this._geosearchCore._providers.length; i++) {\n      this._geosearchCore._providers[i].addEventParent(this);\n    }\n\n    this._geosearchCore._pendingSuggestions = [];\n\n    L.Control.prototype.initialize.call(options);\n  },\n\n  _renderSuggestions: function (suggestions) {\n    var currentGroup;\n    this._suggestions.style.display = 'block';\n\n    // set the maxHeight of the suggestions box to\n    // map height\n    // - suggestions offset (distance from top of suggestions to top of control)\n    // - control offset (distance from top of control to top of map)\n    // - 10 (extra padding)\n    this._suggestions.style.maxHeight = (this._map.getSize().y - this._suggestions.offsetTop - this._wrapper.offsetTop - 10) + 'px';\n\n    var nodes = [];\n    var list;\n    var header;\n\n    for (var i = 0; i < suggestions.length; i++) {\n      var suggestion = suggestions[i];\n      if (!header && this._geosearchCore._providers.length > 1 && currentGroup !== suggestion.provider.options.label) {\n        header = L.DomUtil.create('span', 'geocoder-control-header', this._suggestions);\n        header.textContent = suggestion.provider.options.label;\n        header.innerText = suggestion.provider.options.label;\n        currentGroup = suggestion.provider.options.label;\n        nodes.push(header);\n      }\n\n      if (!list) {\n        list = L.DomUtil.create('ul', 'geocoder-control-list', this._suggestions);\n      }\n\n      var suggestionItem = L.DomUtil.create('li', 'geocoder-control-suggestion', list);\n\n      suggestionItem.innerHTML = suggestion.text;\n      suggestionItem.provider = suggestion.provider;\n      suggestionItem['data-magic-key'] = suggestion.magicKey;\n    }\n\n    L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\n\n    nodes.push(list);\n\n    return nodes;\n  },\n\n  _boundsFromResults: function (results) {\n    if (!results.length) {\n      return;\n    }\n\n    var nullIsland = L.latLngBounds([0, 0], [0, 0]);\n    var resultBounds = [];\n    var resultLatlngs = [];\n\n    // collect the bounds and center of each result\n    for (var i = results.length - 1; i >= 0; i--) {\n      var result = results[i];\n\n      resultLatlngs.push(result.latlng);\n\n      // make sure bounds are valid and not 0,0. sometimes bounds are incorrect or not present\n      if (result.bounds && result.bounds.isValid() && !result.bounds.equals(nullIsland)) {\n        resultBounds.push(result.bounds);\n      }\n    }\n\n    // form a bounds object containing all center points\n    var bounds = L.latLngBounds(resultLatlngs);\n\n    // and extend it to contain all bounds objects\n    for (var j = 0; j < resultBounds.length; j++) {\n      bounds.extend(resultBounds[j]);\n    }\n\n    return bounds;\n  },\n\n  clear: function () {\n    this._suggestions.innerHTML = '';\n    this._suggestions.style.display = 'none';\n    this._input.value = '';\n\n    if (this.options.collapseAfterResult) {\n      this._input.placeholder = '';\n      L.DomUtil.removeClass(this._wrapper, 'geocoder-control-expanded');\n    }\n\n    if (!this._map.scrollWheelZoom.enabled() && this._map.options.scrollWheelZoom) {\n      this._map.scrollWheelZoom.enable();\n    }\n  },\n\n  clearSuggestions: function () {\n    if (this._nodes) {\n      for (var k = 0; k < this._nodes.length; k++) {\n        if (this._nodes[k].parentElement) {\n          this._suggestions.removeChild(this._nodes[k]);\n        }\n      }\n    }\n  },\n\n  _setupClick: function () {\n    L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n    this._input.focus();\n  },\n\n  disable: function () {\n    this._input.disabled = true;\n    L.DomUtil.addClass(this._input, 'geocoder-control-input-disabled');\n    L.DomEvent.removeListener(this._wrapper, 'click', this._setupClick, this);\n  },\n\n  enable: function () {\n    this._input.disabled = false;\n    L.DomUtil.removeClass(this._input, 'geocoder-control-input-disabled');\n    L.DomEvent.addListener(this._wrapper, 'click', this._setupClick, this);\n  },\n\n  getAttribution: function () {\n    var attribs = [];\n\n    for (var i = 0; i < this._providers.length; i++) {\n      if (this._providers[i].options.attribution) {\n        attribs.push(this._providers[i].options.attribution);\n      }\n    }\n\n    return attribs.join(', ');\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n    this._wrapper = L.DomUtil.create('div', 'geocoder-control ' + ((this.options.expanded) ? ' ' + 'geocoder-control-expanded' : ''));\n    this._input = L.DomUtil.create('input', 'geocoder-control-input leaflet-bar', this._wrapper);\n    this._input.title = this.options.title;\n\n    this._suggestions = L.DomUtil.create('div', 'geocoder-control-suggestions leaflet-bar', this._wrapper);\n\n    var credits = this._geosearchCore._getAttribution();\n    map.attributionControl.addAttribution(credits);\n\n    L.DomEvent.addListener(this._input, 'focus', function (e) {\n      this._input.placeholder = this.options.placeholder;\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n    }, this);\n\n    L.DomEvent.addListener(this._wrapper, 'click', this._setupClick, this);\n\n    L.DomEvent.addListener(this._suggestions, 'mousedown', function (e) {\n      var suggestionItem = e.target || e.srcElement;\n      this._geosearchCore._geocode(suggestionItem.innerHTML, suggestionItem['data-magic-key'], suggestionItem.provider);\n      this.clear();\n    }, this);\n\n    L.DomEvent.addListener(this._input, 'blur', function (e) {\n      this.clear();\n    }, this);\n\n    L.DomEvent.addListener(this._input, 'keydown', function (e) {\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n\n      var list = this._suggestions.querySelectorAll('.' + 'geocoder-control-suggestion');\n      var selected = this._suggestions.querySelectorAll('.' + 'geocoder-control-selected')[0];\n      var selectedPosition;\n\n      for (var i = 0; i < list.length; i++) {\n        if (list[i] === selected) {\n          selectedPosition = i;\n          break;\n        }\n      }\n\n      switch (e.keyCode) {\n        case 13:\n          if (selected) {\n            this._geosearchCore._geocode(selected.innerHTML, selected['data-magic-key'], selected.provider);\n            this.clear();\n          } else if (this.options.allowMultipleResults) {\n            this._geosearchCore._geocode(this._input.value, undefined);\n            this.clear();\n          } else {\n            L.DomUtil.addClass(list[0], 'geocoder-control-selected');\n          }\n          L.DomEvent.preventDefault(e);\n          break;\n        case 38:\n          if (selected) {\n            L.DomUtil.removeClass(selected, 'geocoder-control-selected');\n          }\n\n          var previousItem = list[selectedPosition - 1];\n\n          if (selected && previousItem) {\n            L.DomUtil.addClass(previousItem, 'geocoder-control-selected');\n          } else {\n            L.DomUtil.addClass(list[list.length - 1], 'geocoder-control-selected');\n          }\n          L.DomEvent.preventDefault(e);\n          break;\n        case 40:\n          if (selected) {\n            L.DomUtil.removeClass(selected, 'geocoder-control-selected');\n          }\n\n          var nextItem = list[selectedPosition + 1];\n\n          if (selected && nextItem) {\n            L.DomUtil.addClass(nextItem, 'geocoder-control-selected');\n          } else {\n            L.DomUtil.addClass(list[0], 'geocoder-control-selected');\n          }\n          L.DomEvent.preventDefault(e);\n          break;\n        default:\n          // when the input changes we should cancel all pending suggestion requests if possible to avoid result collisions\n          for (var x = 0; x < this._geosearchCore._pendingSuggestions.length; x++) {\n            var request = this._geosearchCore._pendingSuggestions[x];\n            if (request && request.abort && !request.id) {\n              request.abort();\n            }\n          }\n          break;\n      }\n    }, this);\n\n    L.DomEvent.addListener(this._input, 'keyup', L.Util.throttle(function (e) {\n      var key = e.which || e.keyCode;\n      var text = (e.target || e.srcElement).value;\n\n      // require at least 2 characters for suggestions\n      if (text.length < 2) {\n        this._suggestions.innerHTML = '';\n        this._suggestions.style.display = 'none';\n        L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\n        return;\n      }\n\n      // if this is the escape key it will clear the input so clear suggestions\n      if (key === 27) {\n        this._suggestions.innerHTML = '';\n        this._suggestions.style.display = 'none';\n        return;\n      }\n\n      // if this is NOT the up/down arrows or enter make a suggestion\n      if (key !== 13 && key !== 38 && key !== 40) {\n        if (this._input.value !== this._lastValue) {\n          this._lastValue = this._input.value;\n          L.DomUtil.addClass(this._input, 'geocoder-control-loading');\n          this._geosearchCore._suggest(text);\n        }\n      }\n    }, 50, this), this);\n\n    L.DomEvent.disableClickPropagation(this._wrapper);\n\n    // when mouse moves over suggestions disable scroll wheel zoom if its enabled\n    L.DomEvent.addListener(this._suggestions, 'mouseover', function (e) {\n      if (map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom) {\n        map.scrollWheelZoom.disable();\n      }\n    });\n\n    // when mouse moves leaves suggestions enable scroll wheel zoom if its disabled\n    L.DomEvent.addListener(this._suggestions, 'mouseout', function (e) {\n      if (!map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom) {\n        map.scrollWheelZoom.enable();\n      }\n    });\n\n    this._geosearchCore.on('load', function (e) {\n      L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\n      this.clear();\n      this._input.blur();\n    }, this);\n\n    return this._wrapper;\n  },\n\n  onRemove: function (map) {\n    map.attributionControl.removeAttribution('Geocoding by Esri');\n  }\n});\n\nexport function geosearch (options) {\n  return new Geosearch(options);\n}\n\nexport default geosearch;\n","import { GeocodeService } from '../Services/Geocode';\n\nexport var ArcgisOnlineProvider = GeocodeService.extend({\n  options: {\n    label: 'Places and Addresses',\n    maxResults: 5,\n    attribution: '<a href=\"https://developers.arcgis.com/en/features/geocoding/\">Geocoding by Esri</a>'\n  },\n\n  suggestions: function (text, bounds, callback) {\n    var request = this.suggest().text(text);\n\n    if (bounds) {\n      request.within(bounds);\n    }\n\n    if (this.options.countries) {\n      request.countries(this.options.countries);\n    }\n\n    if (this.options.categories) {\n      request.category(this.options.categories);\n    }\n\n    // 15 is the maximum number of suggestions that can be returned\n    request.maxSuggestions(this.options.maxResults);\n\n    return request.run(function (error, results, response) {\n      var suggestions = [];\n      if (!error) {\n        while (response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)) {\n          var suggestion = response.suggestions.shift();\n          if (!suggestion.isCollection) {\n            suggestions.push({\n              text: suggestion.text,\n              magicKey: suggestion.magicKey\n            });\n          }\n        }\n      }\n      callback(error, suggestions);\n    }, this);\n  },\n\n  results: function (text, key, bounds, callback) {\n    var request = this.geocode().text(text);\n\n    if (key) {\n      request.key(key);\n    }\n    // in the future Address/StreetName geocoding requests that include a magicKey will only return one match\n    request.maxLocations(this.options.maxResults);\n\n    if (bounds) {\n      request.within(bounds);\n    }\n\n    if (this.options.forStorage) {\n      request.forStorage(true);\n    }\n\n    return request.run(function (error, response) {\n      callback(error, response.results);\n    }, this);\n  }\n});\n\nexport function arcgisOnlineProvider (options) {\n  return new ArcgisOnlineProvider(options);\n}\n\nexport default arcgisOnlineProvider;\n","import L from 'leaflet';\nimport { FeatureLayerService } from 'esri-leaflet';\n\nexport var FeatureLayerProvider = FeatureLayerService.extend({\n  options: {\n    label: 'Feature Layer',\n    maxResults: 5,\n    bufferRadius: 1000,\n    formatSuggestion: function (feature) {\n      return feature.properties[this.options.searchFields[0]];\n    }\n  },\n\n  initialize: function (options) {\n    FeatureLayerService.prototype.initialize.call(this, options);\n    if (typeof this.options.searchFields === 'string') {\n      this.options.searchFields = [this.options.searchFields];\n    }\n  },\n\n  suggestions: function (text, bounds, callback) {\n    var query = this.query().where(this._buildQuery(text))\n      .returnGeometry(false);\n\n    if (bounds) {\n      query.intersects(bounds);\n    }\n\n    if (this.options.idField) {\n      query.fields([this.options.idField].concat(this.options.searchFields));\n    }\n\n    var request = query.run(function (error, results, raw) {\n      if (error) {\n        callback(error, []);\n      } else {\n        this.options.idField = raw.objectIdFieldName;\n        var suggestions = [];\n        var count = Math.min(results.features.length, this.options.maxResults);\n        for (var i = 0; i < count; i++) {\n          var feature = results.features[i];\n          suggestions.push({\n            text: this.options.formatSuggestion.call(this, feature),\n            magicKey: feature.id\n          });\n        }\n        callback(error, suggestions.slice(0, this.options.maxResults).reverse());\n      }\n    }, this);\n\n    return request;\n  },\n\n  results: function (text, key, bounds, callback) {\n    var query = this.query();\n\n    if (key) {\n      query.featureIds([key]);\n    } else {\n      query.where(this._buildQuery(text));\n    }\n\n    if (bounds) {\n      query.within(bounds);\n    }\n\n    return query.run(L.Util.bind(function (error, features) {\n      var results = [];\n      for (var i = 0; i < features.features.length; i++) {\n        var feature = features.features[i];\n        if (feature) {\n          var bounds = this._featureBounds(feature);\n\n          var result = {\n            latlng: bounds.getCenter(),\n            bounds: bounds,\n            text: this.options.formatSuggestion.call(this, feature),\n            properties: feature.properties,\n            geojson: feature\n          };\n\n          results.push(result);\n        }\n      }\n      callback(error, results);\n    }, this));\n  },\n\n  _buildQuery: function (text) {\n    var queryString = [];\n\n    for (var i = this.options.searchFields.length - 1; i >= 0; i--) {\n      var field = 'upper(\"' + this.options.searchFields[i] + '\")';\n\n      queryString.push(field + \" LIKE upper('%\" + text + \"%')\");\n    }\n\n    return queryString.join(' OR ');\n  },\n\n  _featureBounds: function (feature) {\n    var geojson = L.geoJson(feature);\n    if (feature.geometry.type === 'Point') {\n      var center = geojson.getBounds().getCenter();\n      var lngRadius = ((this.options.bufferRadius / 40075017) * 360) / Math.cos((180 / Math.PI) * center.lat);\n      var latRadius = (this.options.bufferRadius / 40075017) * 360;\n      return L.latLngBounds([center.lat - latRadius, center.lng - lngRadius], [center.lat + latRadius, center.lng + lngRadius]);\n    } else {\n      return geojson.getBounds();\n    }\n  }\n});\n\nexport function featureLayerProvider (options) {\n  return new FeatureLayerProvider(options);\n}\n\nexport default featureLayerProvider;\n","import L from 'leaflet';\nimport { MapService } from 'esri-leaflet';\n\nexport var MapServiceProvider = MapService.extend({\n  options: {\n    layers: [0],\n    label: 'Map Service',\n    bufferRadius: 1000,\n    maxResults: 5,\n    formatSuggestion: function (feature) {\n      return feature.properties[feature.displayFieldName] + ' <small>' + feature.layerName + '</small>';\n    }\n  },\n\n  initialize: function (options) {\n    MapService.prototype.initialize.call(this, options);\n    this._getIdFields();\n  },\n\n  suggestions: function (text, bounds, callback) {\n    var request = this.find().text(text).fields(this.options.searchFields).returnGeometry(false).layers(this.options.layers);\n\n    return request.run(function (error, results, raw) {\n      var suggestions = [];\n      if (!error) {\n        var count = Math.min(this.options.maxResults, results.features.length);\n        raw.results = raw.results.reverse();\n        for (var i = 0; i < count; i++) {\n          var feature = results.features[i];\n          var result = raw.results[i];\n          var layer = result.layerId;\n          var idField = this._idFields[layer];\n          feature.layerId = layer;\n          feature.layerName = this._layerNames[layer];\n          feature.displayFieldName = this._displayFields[layer];\n          if (idField) {\n            suggestions.push({\n              text: this.options.formatSuggestion.call(this, feature),\n              magicKey: result.attributes[idField] + ':' + layer\n            });\n          }\n        }\n      }\n      callback(error, suggestions.reverse());\n    }, this);\n  },\n\n  results: function (text, key, bounds, callback) {\n    var results = [];\n    var request;\n\n    if (key) {\n      var featureId = key.split(':')[0];\n      var layer = key.split(':')[1];\n      request = this.query().layer(layer).featureIds(featureId);\n    } else {\n      request = this.find().text(text).fields(this.options.searchFields).contains(false).layers(this.options.layers);\n    }\n\n    return request.run(function (error, features, response) {\n      if (!error) {\n        if (response.results) {\n          response.results = response.results.reverse();\n        }\n        for (var i = 0; i < features.features.length; i++) {\n          var feature = features.features[i];\n          layer = layer || response.results[i].layerId;\n\n          if (feature && layer !== undefined) {\n            var bounds = this._featureBounds(feature);\n            feature.layerId = layer;\n            feature.layerName = this._layerNames[layer];\n            feature.displayFieldName = this._displayFields[layer];\n\n            var result = {\n              latlng: bounds.getCenter(),\n              bounds: bounds,\n              text: this.options.formatSuggestion.call(this, feature),\n              properties: feature.properties,\n              geojson: feature\n            };\n\n            results.push(result);\n          }\n        }\n      }\n      callback(error, results.reverse());\n    }, this);\n  },\n\n  _featureBounds: function (feature) {\n    var geojson = L.geoJson(feature);\n    if (feature.geometry.type === 'Point') {\n      var center = geojson.getBounds().getCenter();\n      var lngRadius = ((this.options.bufferRadius / 40075017) * 360) / Math.cos((180 / Math.PI) * center.lat);\n      var latRadius = (this.options.bufferRadius / 40075017) * 360;\n      return L.latLngBounds([center.lat - latRadius, center.lng - lngRadius], [center.lat + latRadius, center.lng + lngRadius]);\n    } else {\n      return geojson.getBounds();\n    }\n  },\n\n  _layerMetadataCallback: function (layerid) {\n    return L.Util.bind(function (error, metadata) {\n      if (error) { return; }\n      this._displayFields[layerid] = metadata.displayField;\n      this._layerNames[layerid] = metadata.name;\n      for (var i = 0; i < metadata.fields.length; i++) {\n        var field = metadata.fields[i];\n        if (field.type === 'esriFieldTypeOID') {\n          this._idFields[layerid] = field.name;\n          break;\n        }\n      }\n    }, this);\n  },\n\n  _getIdFields: function () {\n    this._idFields = {};\n    this._displayFields = {};\n    this._layerNames = {};\n    for (var i = 0; i < this.options.layers.length; i++) {\n      var layer = this.options.layers[i];\n      this.get(layer, {}, this._layerMetadataCallback(layer));\n    }\n  }\n});\n\nexport function mapServiceProvider (options) {\n  return new MapServiceProvider(options);\n}\n\nexport default mapServiceProvider;\n","import { GeocodeService } from '../Services/Geocode';\n\nexport var GeocodeServiceProvider = GeocodeService.extend({\n  options: {\n    label: 'Geocode Server',\n    maxResults: 5\n  },\n\n  suggestions: function (text, bounds, callback) {\n    if (this.options.supportsSuggest) {\n      var request = this.suggest().text(text);\n      if (bounds) {\n        request.within(bounds);\n      }\n\n      return request.run(function (error, results, response) {\n        var suggestions = [];\n        if (!error) {\n          while (response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)) {\n            var suggestion = response.suggestions.shift();\n            if (!suggestion.isCollection) {\n              suggestions.push({\n                text: suggestion.text,\n                magicKey: suggestion.magicKey\n              });\n            }\n          }\n        }\n        callback(error, suggestions);\n      }, this);\n    } else {\n      callback(undefined, []);\n      return false;\n    }\n  },\n\n  results: function (text, key, bounds, callback) {\n    var request = this.geocode().text(text);\n\n    request.maxLocations(this.options.maxResults);\n\n    if (bounds) {\n      request.within(bounds);\n    }\n\n    return request.run(function (error, response) {\n      callback(error, response.results);\n    }, this);\n  }\n});\n\nexport function geocodeServiceProvider (options) {\n  return new GeocodeServiceProvider(options);\n}\n\nexport default geocodeServiceProvider;\n","export { version as VERSION } from '../package.json';\nexport var WorldGeocodingServiceUrl = 'https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/';\n\n// import tasks\nexport { Geocode, geocode } from './Tasks/Geocode';\nexport { ReverseGeocode, reverseGeocode } from './Tasks/ReverseGeocode';\nexport { Suggest, suggest } from './Tasks/Suggest';\n\n// import service\nexport { GeocodeService, geocodeService } from './Services/Geocode';\n\n// import control\nexport { Geosearch, geosearch } from './Controls/Geosearch';\n\n// import supporting class\nexport { GeosearchCore, geosearchCore } from './Classes/GeosearchCore';\n\n// import providers\nexport { ArcgisOnlineProvider, arcgisOnlineProvider } from './Providers/ArcgisOnlineGeocoder';\nexport { FeatureLayerProvider, featureLayerProvider } from './Providers/FeatureLayer';\nexport { MapServiceProvider, mapServiceProvider } from './Providers/MapService';\nexport { GeocodeServiceProvider, geocodeServiceProvider } from './Providers/GeocodeService';\n"],"names":["geocode","options","Geocode","reverseGeocode","ReverseGeocode","suggest","Suggest","geocodeService","GeocodeService","geosearchCore","control","GeosearchCore","geosearch","Geosearch","arcgisOnlineProvider","ArcgisOnlineProvider","featureLayerProvider","FeatureLayerProvider","mapServiceProvider","MapServiceProvider","geocodeServiceProvider","GeocodeServiceProvider","Task","extend","path","params","outSr","forStorage","outFields","maxLocations","setters","address","neighborhood","city","subregion","region","postal","country","text","category","token","key","fields","initialize","url","WorldGeocodingServiceUrl","prototype","call","this","within","bounds","L","latLngBounds","bbox","Util","boundsToExtent","nearby","latlng","radius","latLng","location","lng","lat","distance","Math","min","max","run","callback","context","customParam","searchExtent","request","error","response","processor","_processFindResponse","_processFindAddressCandidatesResponse","results","undefined","i","locations","length","extent","extentToBounds","push","name","score","feature","attributes","Score","geometry","y","x","properties","candidates","candidate","outSR","returnIntersection","language","intersection","result","countries","maxSuggestions","supportsSuggest","pad","center","getCenter","ne","getNorthWest","distanceTo","console","warn","Service","_confirmSuggestSupport","reverse","metadata","capabilities","indexOf","singleLineAddressField","Evented","zoomToResult","useMapBounds","searchBounds","setOptions","_control","providers","Error","_providers","_geocode","provider","activeRequests","allResults","bind","concat","_boundsFromResults","fire","_map","fitBounds","_searchBounds","_suggest","createCallback","suggestions","_suggestions","innerHTML","style","display","_lastRender","nodes","parentElement","removeChild","_input","value","clearSuggestions","_renderSuggestions","_nodes","_pendingSuggestions","getBounds","getZoom","nullIsland","resultBounds","resultLatlngs","isValid","equals","j","_getAttribution","attribs","attribution","join","Control","includes","Mixin","Events","position","collapseAfterResult","expanded","allowMultipleResults","placeholder","title","_geosearchCore","addEventParent","currentGroup","maxHeight","getSize","offsetTop","_wrapper","list","header","suggestion","label","DomUtil","create","textContent","innerText","suggestionItem","magicKey","removeClass","clear","scrollWheelZoom","enabled","enable","k","_setupClick","addClass","focus","disable","disabled","DomEvent","removeListener","addListener","getAttribution","onAdd","map","credits","attributionControl","addAttribution","e","target","srcElement","selectedPosition","querySelectorAll","selected","keyCode","preventDefault","previousItem","nextItem","abort","id","throttle","which","_lastValue","disableClickPropagation","on","blur","onRemove","removeAttribution","maxResults","categories","shift","isCollection","FeatureLayerService","bufferRadius","formatSuggestion","searchFields","query","where","_buildQuery","returnGeometry","intersects","idField","raw","objectIdFieldName","count","features","slice","featureIds","_featureBounds","geojson","queryString","field","geoJson","type","lngRadius","cos","PI","latRadius","MapService","layers","displayFieldName","layerName","_getIdFields","find","layer","layerId","_idFields","_layerNames","_displayFields","featureId","split","contains","_layerMetadataCallback","layerid","displayField","get"],"mappings":";;;+UCqHO,SAASA,GAASC,GACvB,MAAO,IAAIC,GAAQD,GCtEd,QAASE,GAAgBF,GAC9B,MAAO,IAAIG,GAAeH,GCMrB,QAASI,GAASJ,GACvB,MAAO,IAAIK,GAAQL,GCPd,QAASM,GAAgBN,GAC9B,MAAO,IAAIO,GAAeP,GCsIrB,QAASQ,GAAeC,EAAST,GACtC,MAAO,IAAIU,GAAcD,EAAST,GCuI7B,QAASW,GAAWX,GACzB,MAAO,IAAIY,GAAUZ,GC9PhB,QAASa,GAAsBb,GACpC,MAAO,IAAIc,GAAqBd,GC6C3B,QAASe,GAAsBf,GACpC,MAAO,IAAIgB,GAAqBhB,GCc3B,QAASiB,GAAoBjB,GAClC,MAAO,IAAIkB,GAAmBlB,GC9EzB,QAASmB,GAAwBnB,GACtC,MAAO,IAAIoB,GAAuBpB,6CThDzBC,EAAUoB,OAAKC,QACxBC,KAAM,OAENC,QACEC,MAAO,KACPC,YAAY,EACZC,UAAW,IACXC,aAAc,IAGhBC,SACEC,QAAW,UACXC,aAAgB,eAChBC,KAAQ,OACRC,UAAa,YACbC,OAAU,SACVC,OAAU,SACVC,QAAW,UACXC,KAAQ,OACRC,SAAY,WACZC,MAAS,QACTC,IAAO,WACPC,OAAU,YACVf,WAAc,aACdE,aAAgB,gBAGlBc,WAAY,SAAU1C,GACpBA,EAAUA,MACVA,EAAQ2C,IAAM3C,EAAQ2C,KAAOC,EAC7BvB,OAAKwB,UAAUH,WAAWI,KAAKC,KAAM/C,IAGvCgD,OAAQ,SAAUC,GAGhB,MAFAA,GAASC,EAAEC,aAAaF,GACxBF,KAAKvB,OAAO4B,KAAOC,OAAKC,eAAeL,GAChCF,MAGTQ,OAAQ,SAAUC,EAAQC,GAIxB,MAHAD,GAASN,EAAEQ,OAAOF,GAClBT,KAAKvB,OAAOmC,SAAWH,EAAOI,IAAM,IAAMJ,EAAOK,IACjDd,KAAKvB,OAAOsC,SAAWC,KAAKC,IAAID,KAAKE,IAAIR,EAAQ,KAAO,KACjDV,MAGTmB,IAAK,SAAUC,EAAUC,GAcvB,MAbIrB,MAAK/C,QAAQqE,aACftB,KAAKxB,KAAO,wBACZwB,KAAKvB,OAAOuB,KAAK/C,QAAQqE,aAAetB,KAAKvB,OAAOa,WAC7CU,MAAKvB,OAAOa,MAEnBU,KAAKxB,KAAQwB,KAAKvB,OAAW,KAAI,OAAS,wBAG1B,0BAAduB,KAAKxB,MAAoCwB,KAAKvB,OAAO4B,OACvDL,KAAKvB,OAAO8C,aAAevB,KAAKvB,OAAO4B,WAChCL,MAAKvB,OAAO4B,MAGdL,KAAKwB,QAAQ,SAAUC,EAAOC,GACnC,GAAIC,GAA2B,SAAd3B,KAAKxB,KAAmBwB,KAAK4B,qBAAuB5B,KAAK6B,sCACtEC,EAAYL,EAA+BM,OAAtBJ,EAAUD,EACnCN,GAASrB,KAAKsB,EAASI,GAASK,QAASA,GAAWJ,IACnD1B,OAGL4B,qBAAsB,SAAUF,GAG9B,IAAK,GAFDI,MAEKE,EAAI,EAAGA,EAAIN,EAASO,UAAUC,OAAQF,IAAK,CAClD,GACI9B,GADAU,EAAWc,EAASO,UAAUD,EAG9BpB,GAASuB,SACXjC,EAASI,OAAK8B,eAAexB,EAASuB,SAGxCL,EAAQO,MACN/C,KAAMsB,EAAS0B,KACfpC,OAAQA,EACRqC,MAAO3B,EAAS4B,QAAQC,WAAWC,MACnCjC,OAAQN,EAAEQ,OAAOC,EAAS4B,QAAQG,SAASC,EAAGhC,EAAS4B,QAAQG,SAASE,GACxEC,WAAYlC,EAAS4B,QAAQC,aAIjC,MAAOX,IAGTD,sCAAuC,SAAUH,GAG/C,IAAK,GAFDI,MAEKE,EAAI,EAAGA,EAAIN,EAASqB,WAAWb,OAAQF,IAAK,CACnD,GAAIgB,GAAYtB,EAASqB,WAAWf,EACpC,IAAIgB,EAAUb,OACZ,GAAIjC,GAASI,OAAK8B,eAAeY,EAAUb,OAG7CL,GAAQO,MACN/C,KAAM0D,EAAUjE,QAChBmB,OAAQA,EACRqC,MAAOS,EAAUT,MACjB9B,OAAQN,EAAEQ,OAAOqC,EAAUpC,SAASgC,EAAGI,EAAUpC,SAASiC,GAC1DC,WAAYE,EAAUP,aAI1B,MAAOX,MC5GA1E,EAAiBkB,OAAKC,QAC/BC,KAAM,iBAENC,QACEwE,MAAO,KACPC,oBAAoB,GAGtBpE,SACEiC,SAAY,WACZoC,SAAY,WACZC,aAAgB,sBAGlBzD,WAAY,SAAU1C,GACpBA,EAAUA,MACVA,EAAQ2C,IAAM3C,EAAQ2C,KAAOC,EAC7BvB,OAAKwB,UAAUH,WAAWI,KAAKC,KAAM/C,IAGvCwD,OAAQ,SAAUA,GAGhB,MAFAA,GAASN,EAAEQ,OAAOF,GAClBT,KAAKvB,OAAOmC,SAAWH,EAAOI,IAAM,IAAMJ,EAAOK,IAC1Cd,MAGTmB,IAAK,SAAUC,EAAUC,GACvB,MAAOrB,MAAKwB,QAAQ,SAAUC,EAAOC,GACnC,GAAI2B,EAQFA,GANG5B,EAMMM,QAJPtB,OAAQN,EAAEQ,OAAOe,EAASd,SAASgC,EAAGlB,EAASd,SAASiC,GACxD9D,QAAS2C,EAAS3C,SAMtBqC,EAASrB,KAAKsB,EAASI,EAAO4B,EAAQ3B,IACrC1B,SCxCI1C,EAAUgB,OAAKC,QACxBC,KAAM,UAENC,UAEAK,SACEQ,KAAM,OACNC,SAAU,WACV+D,UAAW,cACXC,eAAgB,kBAGlB5D,WAAY,SAAU1C,GACpBA,EAAUA,MACLA,EAAQ2C,MACX3C,EAAQ2C,IAAMC,EACd5C,EAAQuG,iBAAkB,GAE5BlF,OAAKwB,UAAUH,WAAWI,KAAKC,KAAM/C,IAGvCgD,OAAQ,SAAUC,GAChBA,EAASC,EAAEC,aAAaF,GACxBA,EAASA,EAAOuD,IAAI,GACpB,IAAIC,GAASxD,EAAOyD,YAChBC,EAAK1D,EAAO2D,cAIhB,OAHA7D,MAAKvB,OAAOmC,SAAW8C,EAAO7C,IAAM,IAAM6C,EAAO5C,IACjDd,KAAKvB,OAAOsC,SAAWC,KAAKC,IAAID,KAAKE,IAAIwC,EAAOI,WAAWF,GAAK,KAAO,KACvE5D,KAAKvB,OAAO8C,aAAejB,OAAKC,eAAeL,GACxCF,MAGTQ,OAAQ,SAAUC,EAAQC,GAIxB,MAHAD,GAASN,EAAEQ,OAAOF,GAClBT,KAAKvB,OAAOmC,SAAWH,EAAOI,IAAM,IAAMJ,EAAOK,IACjDd,KAAKvB,OAAOsC,SAAWC,KAAKC,IAAID,KAAKE,IAAIR,EAAQ,KAAO,KACjDV,MAGTmB,IAAK,SAAUC,EAAUC,GACvB,MAAIrB,MAAK/C,QAAQuG,gBACRxD,KAAKwB,QAAQ,SAAUC,EAAOC,GACnCN,EAASrB,KAAKsB,EAASI,EAAOC,EAAUA,IACvC1B,UAEH+D,SAAQC,KAAK,qEC3CRxG,EAAiByG,UAAQ1F,QAClCoB,WAAY,SAAU1C,GACpBA,EAAUA,MACNA,EAAQ2C,KACVqE,UAAQnE,UAAUH,WAAWI,KAAKC,KAAM/C,GACxC+C,KAAKkE,2BAELjH,EAAQ2C,IAAMC,EACd5C,EAAQuG,iBAAkB,EAC1BS,UAAQnE,UAAUH,WAAWI,KAAKC,KAAM/C,KAI5CD,QAAS,WACP,MAAOA,GAAQgD,OAGjBmE,QAAS,WACP,MAAOhH,GAAe6C,OAGxB3C,QAAS,WAEP,MAAOA,GAAQ2C,OAGjBkE,uBAAwB,WACtBlE,KAAKoE,SAAS,SAAU3C,EAAOC,GACzBD,IAGCC,EAAS2C,aAGH3C,EAAS2C,aAAaC,QAAQ,YAAa,EACpDtE,KAAK/C,QAAQuG,iBAAkB,EAE/BxD,KAAK/C,QAAQuG,iBAAkB,GAL/BxD,KAAK/C,QAAQuG,iBAAkB,EAC/BxD,KAAK/C,QAAQqE,YAAcI,EAAS6C,uBAAuBjC,QAM5DtC,SC3CIrC,EAAgBwC,EAAEqE,QAAQjG,QAEnCtB,SACEwH,cAAc,EACdC,aAAc,GACdC,aAAc,MAGhBhF,WAAY,SAAUjC,EAAST,GAI7B,GAHAkD,EAAEG,KAAKsE,WAAW5E,KAAM/C,GACxB+C,KAAK6E,SAAWnH,GAEXT,IAAYA,EAAQ6H,YAAc7H,EAAQ6H,UAAU5C,OACvD,KAAM,IAAI6C,OAAM,yCAGlB/E,MAAKgF,WAAa/H,EAAQ6H,WAG5BG,SAAU,SAAU3F,EAAMG,EAAKyF,GAC7B,GAEIhF,GAFAiF,EAAiB,EACjBC,KAGAhE,EAAWjB,EAAEG,KAAK+E,KAAK,SAAU5D,EAAOK,GAC1CqD,IACI1D,IAIAK,IACFsD,EAAaA,EAAWE,OAAOxD,IAG7BqD,GAAkB,IACpBjF,EAASF,KAAKuF,mBAAmBH,GAEjCpF,KAAKwF,KAAK,WACR1D,QAASsD,EACTlF,OAAQA,EACRO,OAAQ,EAAWP,EAAOyD,YAAc5B,OACxCzC,KAAMA,IACL,GAECU,KAAK/C,QAAQwH,cAAgBvE,GAC/BF,KAAK6E,SAASY,KAAKC,UAAUxF,GAG/BF,KAAKwF,KAAK,WAEXxF,KAEH,IAAIP,EACF0F,IACAD,EAASpD,QAAQxC,EAAMG,EAAKO,KAAK2F,gBAAiBvE,OAElD,KAAK,GAAIY,GAAI,EAAGA,EAAIhC,KAAKgF,WAAW9C,OAAQF,IAC1CmD,IACAnF,KAAKgF,WAAWhD,GAAGF,QAAQxC,EAAMG,EAAKO,KAAK2F,gBAAiBvE,IAKlEwE,SAAU,SAAUtG,GAClB,GAAI6F,GAAiBnF,KAAKgF,WAAW9C,OAEjC2D,EAAiB1F,EAAEG,KAAK+E,KAAK,SAAU/F,EAAM4F,GAC/C,MAAO/E,GAAEG,KAAK+E,KAAK,SAAU5D,EAAOqE,GAClC,IAAIrE,EAAJ,CAEA,GAAIO,EAIJ,IAFAmD,GAAkC,EAE9B7F,EAAK4C,OAAS,EAGhB,MAFAlC,MAAK+F,aAAaC,UAAY,QAC9BhG,KAAK+F,aAAaE,MAAMC,QAAU,OAIpC,IAAIJ,EACF,IAAK9D,EAAI,EAAGA,EAAI8D,EAAY5D,OAAQF,IAClC8D,EAAY9D,GAAGkD,SAAWA,CAI9B,IAAIA,EAASiB,cAAgB7G,GAAQ4F,EAASkB,MAAO,CACnD,IAAKpE,EAAI,EAAGA,EAAIkD,EAASkB,MAAMlE,OAAQF,IACjCkD,EAASkB,MAAMpE,GAAGqE,eACpBrG,KAAK6E,SAASkB,aAAaO,YAAYpB,EAASkB,MAAMpE,GAI1DkD,GAASkB,SAGPN,EAAY5D,QAAUlC,KAAK6E,SAAS0B,OAAOC,QAAUlH,IACvDU,KAAK6E,SAAS4B,iBAAiBvB,EAASkB,OAExClB,EAASiB,YAAc7G,EACvB4F,EAASkB,MAAQpG,KAAK6E,SAAS6B,mBAAmBZ,GAClD9F,KAAK6E,SAAS8B,aAEf3G,OACFA,KAEHA,MAAK4G,sBAEL,KAAK,GAAI5E,GAAI,EAAGA,EAAIhC,KAAKgF,WAAW9C,OAAQF,IAAK,CAC/C,GAAIkD,GAAWlF,KAAKgF,WAAWhD,GAC3BR,EAAU0D,EAASY,YAAYxG,EAAMU,KAAK2F,gBAAiBE,EAAevG,EAAM4F,GACpFlF,MAAK4G,oBAAoBvE,KAAKb,KAIlCmE,cAAe,WACb,MAAkC,QAA9B3F,KAAK/C,QAAQ0H,aACR3E,KAAK/C,QAAQ0H,aAGlB3E,KAAK/C,QAAQyH,gBAAiB,EACzB,KAGL1E,KAAK/C,QAAQyH,gBAAiB,EACzB1E,KAAK6E,SAASY,KAAKoB,YAGxB7G,KAAK/C,QAAQyH,cAAgB1E,KAAK6E,SAASY,KAAKqB,UAC3C9G,KAAK6E,SAASY,KAAKoB,YAGrB,MAGTtB,mBAAoB,SAAUzD,GAC5B,GAAKA,EAAQI,OAAb,CASA,IAAK,GALD6E,GAAa5G,EAAEC,cAAc,EAAG,IAAK,EAAG,IACxC4G,KACAC,KAGKjF,EAAIF,EAAQI,OAAS,EAAGF,GAAK,EAAGA,IAAK,CAC5C,GAAIqB,GAASvB,EAAQE,EAErBiF,GAAc5E,KAAKgB,EAAO5C,QAGtB4C,EAAOnD,QAAUmD,EAAOnD,OAAOgH,YAAc7D,EAAOnD,OAAOiH,OAAOJ,IACpEC,EAAa3E,KAAKgB,EAAOnD,QAQ7B,IAAK,GAHDA,GAASC,EAAEC,aAAa6G,GAGnBG,EAAI,EAAGA,EAAIJ,EAAa9E,OAAQkF,IACvClH,EAAO3B,OAAOyI,EAAaI,GAG7B,OAAOlH,KAGTmH,gBAAiB,WAIf,IAAK,GAHDC,MACAxC,EAAY9E,KAAKgF,WAEZhD,EAAI,EAAGA,EAAI8C,EAAU5C,OAAQF,IAChC8C,EAAU9C,GAAG/E,QAAQsK,aACvBD,EAAQjF,KAAKyC,EAAU9C,GAAG/E,QAAQsK,YAItC,OAAOD,GAAQE,KAAK,SChLb3J,EAAYsC,EAAEsH,QAAQlJ,QAC/BmJ,SAAUvH,EAAEwH,MAAMC,OAElB3K,SACE4K,SAAU,UACVC,qBAAqB,EACrBC,UAAU,EACVC,sBAAsB,EACtBC,YAAa,iCACbC,MAAO,mBAGTvI,WAAY,SAAU1C,GAGpB,GAFAkD,EAAEG,KAAKsE,WAAW5E,KAAM/C,IAEnBA,IAAYA,EAAQ6H,YAAc7H,EAAQ6H,UAAU5C,OACvD,KAAM,IAAI6C,OAAM,yCAIlB/E,MAAKmI,eAAiB1K,EAAcuC,KAAM/C,GAC1C+C,KAAKmI,eAAenD,WAAa/H,EAAQ6H,UAGzC9E,KAAKmI,eAAeC,eAAepI,KACnC,KAAK,GAAIgC,GAAI,EAAGA,EAAIhC,KAAKmI,eAAenD,WAAW9C,OAAQF,IACzDhC,KAAKmI,eAAenD,WAAWhD,GAAGoG,eAAepI,KAGnDA,MAAKmI,eAAevB,uBAEpBzG,EAAEsH,QAAQ3H,UAAUH,WAAWI,KAAK9C,IAGtCyJ,mBAAoB,SAAUZ,GAC5B,GAAIuC,EACJrI,MAAK+F,aAAaE,MAAMC,QAAU,QAOlClG,KAAK+F,aAAaE,MAAMqC,UAAatI,KAAKyF,KAAK8C,UAAU3F,EAAI5C,KAAK+F,aAAayC,UAAYxI,KAAKyI,SAASD,UAAY,GAAM,IAM3H,KAAK,GAHDE,GACAC,EAFAvC,KAIKpE,EAAI,EAAGA,EAAI8D,EAAY5D,OAAQF,IAAK,CAC3C,GAAI4G,GAAa9C,EAAY9D,IACxB2G,GAAU3I,KAAKmI,eAAenD,WAAW9C,OAAS,GAAKmG,IAAiBO,EAAW1D,SAASjI,QAAQ4L,QACvGF,EAASxI,EAAE2I,QAAQC,OAAO,OAAQ,0BAA2B/I,KAAK+F,cAClE4C,EAAOK,YAAcJ,EAAW1D,SAASjI,QAAQ4L,MACjDF,EAAOM,UAAYL,EAAW1D,SAASjI,QAAQ4L,MAC/CR,EAAeO,EAAW1D,SAASjI,QAAQ4L,MAC3CzC,EAAM/D,KAAKsG,IAGRD,IACHA,EAAOvI,EAAE2I,QAAQC,OAAO,KAAM,wBAAyB/I,KAAK+F,cAG9D,IAAImD,GAAiB/I,EAAE2I,QAAQC,OAAO,KAAM,8BAA+BL,EAE3EQ,GAAelD,UAAY4C,EAAWtJ,KACtC4J,EAAehE,SAAW0D,EAAW1D,SACrCgE,EAAe,kBAAoBN,EAAWO,SAOhD,MAJAhJ,GAAE2I,QAAQM,YAAYpJ,KAAKuG,OAAQ,4BAEnCH,EAAM/D,KAAKqG,GAEJtC,GAGTb,mBAAoB,SAAUzD,GAC5B,GAAKA,EAAQI,OAAb,CASA,IAAK,GALD6E,GAAa5G,EAAEC,cAAc,EAAG,IAAK,EAAG,IACxC4G,KACAC,KAGKjF,EAAIF,EAAQI,OAAS,EAAGF,GAAK,EAAGA,IAAK,CAC5C,GAAIqB,GAASvB,EAAQE,EAErBiF,GAAc5E,KAAKgB,EAAO5C,QAGtB4C,EAAOnD,QAAUmD,EAAOnD,OAAOgH,YAAc7D,EAAOnD,OAAOiH,OAAOJ,IACpEC,EAAa3E,KAAKgB,EAAOnD,QAQ7B,IAAK,GAHDA,GAASC,EAAEC,aAAa6G,GAGnBG,EAAI,EAAGA,EAAIJ,EAAa9E,OAAQkF,IACvClH,EAAO3B,OAAOyI,EAAaI,GAG7B,OAAOlH,KAGTmJ,MAAO,WACLrJ,KAAK+F,aAAaC,UAAY,GAC9BhG,KAAK+F,aAAaE,MAAMC,QAAU,OAClClG,KAAKuG,OAAOC,MAAQ,GAEhBxG,KAAK/C,QAAQ6K,sBACf9H,KAAKuG,OAAO0B,YAAc,GAC1B9H,EAAE2I,QAAQM,YAAYpJ,KAAKyI,SAAU,+BAGlCzI,KAAKyF,KAAK6D,gBAAgBC,WAAavJ,KAAKyF,KAAKxI,QAAQqM,iBAC5DtJ,KAAKyF,KAAK6D,gBAAgBE,UAI9B/C,iBAAkB,WAChB,GAAIzG,KAAK2G,OACP,IAAK,GAAI8C,GAAI,EAAGA,EAAIzJ,KAAK2G,OAAOzE,OAAQuH,IAClCzJ,KAAK2G,OAAO8C,GAAGpD,eACjBrG,KAAK+F,aAAaO,YAAYtG,KAAK2G,OAAO8C,KAMlDC,YAAa,WACXvJ,EAAE2I,QAAQa,SAAS3J,KAAKyI,SAAU,6BAClCzI,KAAKuG,OAAOqD,SAGdC,QAAS,WACP7J,KAAKuG,OAAOuD,UAAW,EACvB3J,EAAE2I,QAAQa,SAAS3J,KAAKuG,OAAQ,mCAChCpG,EAAE4J,SAASC,eAAehK,KAAKyI,SAAU,QAASzI,KAAK0J,YAAa1J,OAGtEwJ,OAAQ,WACNxJ,KAAKuG,OAAOuD,UAAW,EACvB3J,EAAE2I,QAAQM,YAAYpJ,KAAKuG,OAAQ,mCACnCpG,EAAE4J,SAASE,YAAYjK,KAAKyI,SAAU,QAASzI,KAAK0J,YAAa1J,OAGnEkK,eAAgB,WAGd,IAAK,GAFD5C,MAEKtF,EAAI,EAAGA,EAAIhC,KAAKgF,WAAW9C,OAAQF,IACtChC,KAAKgF,WAAWhD,GAAG/E,QAAQsK,aAC7BD,EAAQjF,KAAKrC,KAAKgF,WAAWhD,GAAG/E,QAAQsK,YAI5C,OAAOD,GAAQE,KAAK,OAGtB2C,MAAO,SAAUC,GACfpK,KAAKyF,KAAO2E,EACZpK,KAAKyI,SAAWtI,EAAE2I,QAAQC,OAAO,MAAO,qBAAwB/I,KAAK/C,QAAgB,SAAI,6BAAoC,KAC7H+C,KAAKuG,OAASpG,EAAE2I,QAAQC,OAAO,QAAS,qCAAsC/I,KAAKyI,UACnFzI,KAAKuG,OAAO2B,MAAQlI,KAAK/C,QAAQiL,MAEjClI,KAAK+F,aAAe5F,EAAE2I,QAAQC,OAAO,MAAO,2CAA4C/I,KAAKyI,SAE7F,IAAI4B,GAAUrK,KAAKmI,eAAed,iBA0IlC,OAzIA+C,GAAIE,mBAAmBC,eAAeF,GAEtClK,EAAE4J,SAASE,YAAYjK,KAAKuG,OAAQ,QAAS,SAAUiE,GACrDxK,KAAKuG,OAAO0B,YAAcjI,KAAK/C,QAAQgL,YACvC9H,EAAE2I,QAAQa,SAAS3J,KAAKyI,SAAU,8BACjCzI,MAEHG,EAAE4J,SAASE,YAAYjK,KAAKyI,SAAU,QAASzI,KAAK0J,YAAa1J,MAEjEG,EAAE4J,SAASE,YAAYjK,KAAK+F,aAAc,YAAa,SAAUyE,GAC/D,GAAItB,GAAiBsB,EAAEC,QAAUD,EAAEE,UACnC1K,MAAKmI,eAAelD,SAASiE,EAAelD,UAAWkD,EAAe,kBAAmBA,EAAehE,UACxGlF,KAAKqJ,SACJrJ,MAEHG,EAAE4J,SAASE,YAAYjK,KAAKuG,OAAQ,OAAQ,SAAUiE,GACpDxK,KAAKqJ,SACJrJ,MAEHG,EAAE4J,SAASE,YAAYjK,KAAKuG,OAAQ,UAAW,SAAUiE,GACvDrK,EAAE2I,QAAQa,SAAS3J,KAAKyI,SAAU,4BAMlC,KAAK,GAFDkC,GAFAjC,EAAO1I,KAAK+F,aAAa6E,iBAAiB,gCAC1CC,EAAW7K,KAAK+F,aAAa6E,iBAAiB,8BAAmC,GAG5E5I,EAAI,EAAGA,EAAI0G,EAAKxG,OAAQF,IAC/B,GAAI0G,EAAK1G,KAAO6I,EAAU,CACxBF,EAAmB3I,CACnB,OAIJ,OAAQwI,EAAEM,SACR,IAAK,IACCD,GACF7K,KAAKmI,eAAelD,SAAS4F,EAAS7E,UAAW6E,EAAS,kBAAmBA,EAAS3F,UACtFlF,KAAKqJ,SACIrJ,KAAK/C,QAAQ+K,sBACtBhI,KAAKmI,eAAelD,SAASjF,KAAKuG,OAAOC,MAAOzE,QAChD/B,KAAKqJ,SAELlJ,EAAE2I,QAAQa,SAASjB,EAAK,GAAI,6BAE9BvI,EAAE4J,SAASgB,eAAeP,EAC1B,MACF,KAAK,IACCK,GACF1K,EAAE2I,QAAQM,YAAYyB,EAAU,4BAGlC,IAAIG,GAAetC,EAAKiC,EAAmB,EAEvCE,IAAYG,EACd7K,EAAE2I,QAAQa,SAASqB,EAAc,6BAEjC7K,EAAE2I,QAAQa,SAASjB,EAAKA,EAAKxG,OAAS,GAAI,6BAE5C/B,EAAE4J,SAASgB,eAAeP,EAC1B,MACF,KAAK,IACCK,GACF1K,EAAE2I,QAAQM,YAAYyB,EAAU,4BAGlC,IAAII,GAAWvC,EAAKiC,EAAmB,EAEnCE,IAAYI,EACd9K,EAAE2I,QAAQa,SAASsB,EAAU,6BAE7B9K,EAAE2I,QAAQa,SAASjB,EAAK,GAAI,6BAE9BvI,EAAE4J,SAASgB,eAAeP,EAC1B,MACF,SAEE,IAAK,GAAI3H,GAAI,EAAGA,EAAI7C,KAAKmI,eAAevB,oBAAoB1E,OAAQW,IAAK,CACvE,GAAIrB,GAAUxB,KAAKmI,eAAevB,oBAAoB/D,EAClDrB,IAAWA,EAAQ0J,QAAU1J,EAAQ2J,IACvC3J,EAAQ0J,WAKflL,MAEHG,EAAE4J,SAASE,YAAYjK,KAAKuG,OAAQ,QAASpG,EAAEG,KAAK8K,SAAS,SAAUZ,GACrE,GAAI/K,GAAM+K,EAAEa,OAASb,EAAEM,QACnBxL,GAAQkL,EAAEC,QAAUD,EAAEE,YAAYlE,KAGtC,OAAIlH,GAAK4C,OAAS,GAChBlC,KAAK+F,aAAaC,UAAY,GAC9BhG,KAAK+F,aAAaE,MAAMC,QAAU,WAClC/F,GAAE2I,QAAQM,YAAYpJ,KAAKuG,OAAQ,6BAKzB,KAAR9G,GACFO,KAAK+F,aAAaC,UAAY,QAC9BhG,KAAK+F,aAAaE,MAAMC,QAAU,cAKxB,KAARzG,GAAsB,KAARA,GAAsB,KAARA,GAC1BO,KAAKuG,OAAOC,QAAUxG,KAAKsL,aAC7BtL,KAAKsL,WAAatL,KAAKuG,OAAOC,MAC9BrG,EAAE2I,QAAQa,SAAS3J,KAAKuG,OAAQ,4BAChCvG,KAAKmI,eAAevC,SAAStG,MAGhC,GAAIU,MAAOA,MAEdG,EAAE4J,SAASwB,wBAAwBvL,KAAKyI,UAGxCtI,EAAE4J,SAASE,YAAYjK,KAAK+F,aAAc,YAAa,SAAUyE,GAC3DJ,EAAId,gBAAgBC,WAAaa,EAAInN,QAAQqM,iBAC/Cc,EAAId,gBAAgBO,YAKxB1J,EAAE4J,SAASE,YAAYjK,KAAK+F,aAAc,WAAY,SAAUyE,IACzDJ,EAAId,gBAAgBC,WAAaa,EAAInN,QAAQqM,iBAChDc,EAAId,gBAAgBE,WAIxBxJ,KAAKmI,eAAeqD,GAAG,OAAQ,SAAUhB,GACvCrK,EAAE2I,QAAQM,YAAYpJ,KAAKuG,OAAQ,4BACnCvG,KAAKqJ,QACLrJ,KAAKuG,OAAOkF,QACXzL,MAEIA,KAAKyI,UAGdiD,SAAU,SAAUtB,GAClBA,EAAIE,mBAAmBqB,kBAAkB,wBC1TlC5N,EAAuBP,EAAee,QAC/CtB,SACE4L,MAAO,uBACP+C,WAAY,EACZrE,YAAa,wFAGfzB,YAAa,SAAUxG,EAAMY,EAAQkB,GACnC,GAAII,GAAUxB,KAAK3C,UAAUiC,KAAKA,EAiBlC,OAfIY,IACFsB,EAAQvB,OAAOC,GAGbF,KAAK/C,QAAQqG,WACf9B,EAAQ8B,UAAUtD,KAAK/C,QAAQqG,WAG7BtD,KAAK/C,QAAQ4O,YACfrK,EAAQjC,SAASS,KAAK/C,QAAQ4O,YAIhCrK,EAAQ+B,eAAevD,KAAK/C,QAAQ2O,YAE7BpK,EAAQL,IAAI,SAAUM,EAAOK,EAASJ,GAC3C,GAAIoE,KACJ,KAAKrE,EACH,KAAOC,EAASoE,YAAY5D,QAAU4D,EAAY5D,QAAWlC,KAAK/C,QAAQ2O,WAAa,GAAI,CACzF,GAAIhD,GAAalH,EAASoE,YAAYgG,OACjClD,GAAWmD,cACdjG,EAAYzD,MACV/C,KAAMsJ,EAAWtJ,KACjB6J,SAAUP,EAAWO,WAK7B/H,EAASK,EAAOqE,IACf9F,OAGL8B,QAAS,SAAUxC,EAAMG,EAAKS,EAAQkB,GACpC,GAAII,GAAUxB,KAAKhD,UAAUsC,KAAKA,EAgBlC,OAdIG,IACF+B,EAAQ/B,IAAIA,GAGd+B,EAAQ3C,aAAamB,KAAK/C,QAAQ2O,YAE9B1L,GACFsB,EAAQvB,OAAOC,GAGbF,KAAK/C,QAAQ0B,YACf6C,EAAQ7C,YAAW,GAGd6C,EAAQL,IAAI,SAAUM,EAAOC,GAClCN,EAASK,EAAOC,EAASI,UACxB9B,SC5DI/B,EAAuB+N,sBAAoBzN,QACpDtB,SACE4L,MAAO,gBACP+C,WAAY,EACZK,aAAc,IACdC,iBAAkB,SAAU1J,GAC1B,MAAOA,GAAQM,WAAW9C,KAAK/C,QAAQkP,aAAa,MAIxDxM,WAAY,SAAU1C,GACpB+O,sBAAoBlM,UAAUH,WAAWI,KAAKC,KAAM/C,GACX,gBAA9B+C,MAAK/C,QAAQkP,eACtBnM,KAAK/C,QAAQkP,cAAgBnM,KAAK/C,QAAQkP,gBAI9CrG,YAAa,SAAUxG,EAAMY,EAAQkB,GACnC,GAAIgL,GAAQpM,KAAKoM,QAAQC,MAAMrM,KAAKsM,YAAYhN,IAC7CiN,gBAAe,EAEdrM,IACFkM,EAAMI,WAAWtM,GAGfF,KAAK/C,QAAQwP,SACfL,EAAM1M,QAAQM,KAAK/C,QAAQwP,SAASnH,OAAOtF,KAAK/C,QAAQkP,cAG1D,IAAI3K,GAAU4K,EAAMjL,IAAI,SAAUM,EAAOK,EAAS4K,GAChD,GAAIjL,EACFL,EAASK,UACJ,CACLzB,KAAK/C,QAAQwP,QAAUC,EAAIC,iBAG3B,KAAK,GAFD7G,MACA8G,EAAQ5L,KAAKC,IAAIa,EAAQ+K,SAAS3K,OAAQlC,KAAK/C,QAAQ2O,YAClD5J,EAAI,EAAGA,EAAI4K,EAAO5K,IAAK,CAC9B,GAAIQ,GAAUV,EAAQ+K,SAAS7K,EAC/B8D,GAAYzD,MACV/C,KAAMU,KAAK/C,QAAQiP,iBAAiBnM,KAAKC,KAAMwC,GAC/C2G,SAAU3G,EAAQ2I,KAGtB/J,EAASK,EAAOqE,EAAYgH,MAAM,EAAG9M,KAAK/C,QAAQ2O,YAAYzH,aAE/DnE,KAEH,OAAOwB,IAGTM,QAAS,SAAUxC,EAAMG,EAAKS,EAAQkB,GACpC,GAAIgL,GAAQpM,KAAKoM,OAYjB,OAVI3M,GACF2M,EAAMW,YAAYtN,IAElB2M,EAAMC,MAAMrM,KAAKsM,YAAYhN,IAG3BY,GACFkM,EAAMnM,OAAOC,GAGRkM,EAAMjL,IAAIhB,EAAEG,KAAK+E,KAAK,SAAU5D,EAAOoL,GAE5C,IAAK,GADD/K,MACKE,EAAI,EAAGA,EAAI6K,EAASA,SAAS3K,OAAQF,IAAK,CACjD,GAAIQ,GAAUqK,EAASA,SAAS7K,EAChC,IAAIQ,EAAS,CACX,GAAItC,GAASF,KAAKgN,eAAexK,GAE7Ba,GACF5C,OAAQP,EAAOyD,YACfzD,OAAQA,EACRZ,KAAMU,KAAK/C,QAAQiP,iBAAiBnM,KAAKC,KAAMwC,GAC/CM,WAAYN,EAAQM,WACpBmK,QAASzK,EAGXV,GAAQO,KAAKgB,IAGjBjC,EAASK,EAAOK,IACf9B,QAGLsM,YAAa,SAAUhN,GAGrB,IAAK,GAFD4N,MAEKlL,EAAIhC,KAAK/C,QAAQkP,aAAajK,OAAS,EAAGF,GAAK,EAAGA,IAAK,CAC9D,GAAImL,GAAQ,UAAYnN,KAAK/C,QAAQkP,aAAanK,GAAK,IAEvDkL,GAAY7K,KAAK8K,EAAQ,iBAAmB7N,EAAO,OAGrD,MAAO4N,GAAY1F,KAAK,SAG1BwF,eAAgB,SAAUxK,GACxB,GAAIyK,GAAU9M,EAAEiN,QAAQ5K,EACxB,IAA8B,UAA1BA,EAAQG,SAAS0K,KAAkB,CACrC,GAAI3J,GAASuJ,EAAQpG,YAAYlD,YAC7B2J,EAActN,KAAK/C,QAAQgP,aAAe,SAAY,IAAOjL,KAAKuM,IAAK,IAAMvM,KAAKwM,GAAM9J,EAAO5C,KAC/F2M,EAAazN,KAAK/C,QAAQgP,aAAe,SAAY,GACzD,OAAO9L,GAAEC,cAAcsD,EAAO5C,IAAM2M,EAAW/J,EAAO7C,IAAMyM,IAAa5J,EAAO5C,IAAM2M,EAAW/J,EAAO7C,IAAMyM,IAE9G,MAAOL,GAAQpG,eCzGV1I,EAAqBuP,aAAWnP,QACzCtB,SACE0Q,QAAS,GACT9E,MAAO,cACPoD,aAAc,IACdL,WAAY,EACZM,iBAAkB,SAAU1J,GAC1B,MAAOA,GAAQM,WAAWN,EAAQoL,kBAAoB,WAAapL,EAAQqL,UAAY,aAI3FlO,WAAY,SAAU1C,GACpByQ,aAAW5N,UAAUH,WAAWI,KAAKC,KAAM/C,GAC3C+C,KAAK8N,gBAGPhI,YAAa,SAAUxG,EAAMY,EAAQkB,GACnC,GAAII,GAAUxB,KAAK+N,OAAOzO,KAAKA,GAAMI,OAAOM,KAAK/C,QAAQkP,cAAcI,gBAAe,GAAOoB,OAAO3N,KAAK/C,QAAQ0Q,OAEjH,OAAOnM,GAAQL,IAAI,SAAUM,EAAOK,EAAS4K,GAC3C,GAAI5G,KACJ,KAAKrE,EAAO,CACV,GAAImL,GAAQ5L,KAAKC,IAAIjB,KAAK/C,QAAQ2O,WAAY9J,EAAQ+K,SAAS3K,OAC/DwK,GAAI5K,QAAU4K,EAAI5K,QAAQqC,SAC1B,KAAK,GAAInC,GAAI,EAAGA,EAAI4K,EAAO5K,IAAK,CAC9B,GAAIQ,GAAUV,EAAQ+K,SAAS7K,GAC3BqB,EAASqJ,EAAI5K,QAAQE,GACrBgM,EAAQ3K,EAAO4K,QACfxB,EAAUzM,KAAKkO,UAAUF,EAC7BxL,GAAQyL,QAAUD,EAClBxL,EAAQqL,UAAY7N,KAAKmO,YAAYH,GACrCxL,EAAQoL,iBAAmB5N,KAAKoO,eAAeJ,GAC3CvB,GACF3G,EAAYzD,MACV/C,KAAMU,KAAK/C,QAAQiP,iBAAiBnM,KAAKC,KAAMwC,GAC/C2G,SAAU9F,EAAOZ,WAAWgK,GAAW,IAAMuB,KAKrD5M,EAASK,EAAOqE,EAAY3B,YAC3BnE,OAGL8B,QAAS,SAAUxC,EAAMG,EAAKS,EAAQkB,GACpC,GACII,GADAM,IAGJ,IAAIrC,EAAK,CACP,GAAI4O,GAAY5O,EAAI6O,MAAM,KAAK,GAC3BN,EAAQvO,EAAI6O,MAAM,KAAK,EAC3B9M,GAAUxB,KAAKoM,QAAQ4B,MAAMA,GAAOjB,WAAWsB,OAE/C7M,GAAUxB,KAAK+N,OAAOzO,KAAKA,GAAMI,OAAOM,KAAK/C,QAAQkP,cAAcoC,UAAS,GAAOZ,OAAO3N,KAAK/C,QAAQ0Q,OAGzG,OAAOnM,GAAQL,IAAI,SAAUM,EAAOoL,EAAUnL,GAC5C,IAAKD,EAAO,CACNC,EAASI,UACXJ,EAASI,QAAUJ,EAASI,QAAQqC,UAEtC,KAAK,GAAInC,GAAI,EAAGA,EAAI6K,EAASA,SAAS3K,OAAQF,IAAK,CACjD,GAAIQ,GAAUqK,EAASA,SAAS7K,EAGhC,IAFAgM,EAAQA,GAAStM,EAASI,QAAQE,GAAGiM,QAEjCzL,GAAqBT,SAAViM,EAAqB,CAClC,GAAI9N,GAASF,KAAKgN,eAAexK,EACjCA,GAAQyL,QAAUD,EAClBxL,EAAQqL,UAAY7N,KAAKmO,YAAYH,GACrCxL,EAAQoL,iBAAmB5N,KAAKoO,eAAeJ,EAE/C,IAAI3K,IACF5C,OAAQP,EAAOyD,YACfzD,OAAQA,EACRZ,KAAMU,KAAK/C,QAAQiP,iBAAiBnM,KAAKC,KAAMwC,GAC/CM,WAAYN,EAAQM,WACpBmK,QAASzK,EAGXV,GAAQO,KAAKgB,KAInBjC,EAASK,EAAOK,EAAQqC,YACvBnE,OAGLgN,eAAgB,SAAUxK,GACxB,GAAIyK,GAAU9M,EAAEiN,QAAQ5K,EACxB,IAA8B,UAA1BA,EAAQG,SAAS0K,KAAkB,CACrC,GAAI3J,GAASuJ,EAAQpG,YAAYlD,YAC7B2J,EAActN,KAAK/C,QAAQgP,aAAe,SAAY,IAAOjL,KAAKuM,IAAK,IAAMvM,KAAKwM,GAAM9J,EAAO5C,KAC/F2M,EAAazN,KAAK/C,QAAQgP,aAAe,SAAY,GACzD,OAAO9L,GAAEC,cAAcsD,EAAO5C,IAAM2M,EAAW/J,EAAO7C,IAAMyM,IAAa5J,EAAO5C,IAAM2M,EAAW/J,EAAO7C,IAAMyM,IAE9G,MAAOL,GAAQpG,aAInB2H,uBAAwB,SAAUC,GAChC,MAAOtO,GAAEG,KAAK+E,KAAK,SAAU5D,EAAO2C,GAClC,IAAI3C,EAAJ,CACAzB,KAAKoO,eAAeK,GAAWrK,EAASsK,aACxC1O,KAAKmO,YAAYM,GAAWrK,EAAS9B,IACrC,KAAK,GAAIN,GAAI,EAAGA,EAAIoC,EAAS1E,OAAOwC,OAAQF,IAAK,CAC/C,GAAImL,GAAQ/I,EAAS1E,OAAOsC,EAC5B,IAAmB,qBAAfmL,EAAME,KAA6B,CACrCrN,KAAKkO,UAAUO,GAAWtB,EAAM7K,IAChC,WAGHtC,OAGL8N,aAAc,WACZ9N,KAAKkO,aACLlO,KAAKoO,kBACLpO,KAAKmO,cACL,KAAK,GAAInM,GAAI,EAAGA,EAAIhC,KAAK/C,QAAQ0Q,OAAOzL,OAAQF,IAAK,CACnD,GAAIgM,GAAQhO,KAAK/C,QAAQ0Q,OAAO3L,EAChChC,MAAK2O,IAAIX,KAAWhO,KAAKwO,uBAAuBR,QCzH3C3P,EAAyBb,EAAee,QACjDtB,SACE4L,MAAO,iBACP+C,WAAY,GAGd9F,YAAa,SAAUxG,EAAMY,EAAQkB,GACnC,GAAIpB,KAAK/C,QAAQuG,gBAAiB,CAChC,GAAIhC,GAAUxB,KAAK3C,UAAUiC,KAAKA,EAKlC,OAJIY,IACFsB,EAAQvB,OAAOC,GAGVsB,EAAQL,IAAI,SAAUM,EAAOK,EAASJ,GAC3C,GAAIoE,KACJ,KAAKrE,EACH,KAAOC,EAASoE,YAAY5D,QAAU4D,EAAY5D,QAAWlC,KAAK/C,QAAQ2O,WAAa,GAAI,CACzF,GAAIhD,GAAalH,EAASoE,YAAYgG,OACjClD,GAAWmD,cACdjG,EAAYzD,MACV/C,KAAMsJ,EAAWtJ,KACjB6J,SAAUP,EAAWO,WAK7B/H,EAASK,EAAOqE,IACf9F,MAGH,MADAoB,GAASW,YACF,GAIXD,QAAS,SAAUxC,EAAMG,EAAKS,EAAQkB,GACpC,GAAII,GAAUxB,KAAKhD,UAAUsC,KAAKA,EAQlC,OANAkC,GAAQ3C,aAAamB,KAAK/C,QAAQ2O,YAE9B1L,GACFsB,EAAQvB,OAAOC,GAGVsB,EAAQL,IAAI,SAAUM,EAAOC,GAClCN,EAASK,EAAOC,EAASI,UACxB9B,SC9CIH,EAA2B"}